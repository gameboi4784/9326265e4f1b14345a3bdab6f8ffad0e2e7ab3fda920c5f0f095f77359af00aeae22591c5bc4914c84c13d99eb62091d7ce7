<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify your ownership of UNDERTALE!</title>
    <base href="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
          font-family: "Determination";
          src: url("https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/fonts/determination.otf") format("opentype");
          font-weight: normal;
          font-style: normal;
        }

        body {
            font-family: 'Determination', sans-serif;
        }

        .drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        #special-popup-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        #special-popup-content {
            transition: all 0.3s ease-in-out;
            transform: scale(0.95);
        }
        #special-popup-backdrop.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #special-popup-backdrop.visible #special-popup-content {
            opacity: 1;
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen transition-colors duration-300">

    <div class="w-full max-w-md mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 transition-all duration-300 z-10">

        <div id="header-content" class="text-center">
            <img src="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/utweb/verif/main.png" class="mx-auto h-12 w-12">
            <h1 class="text-2xl font-bold text-gray-800 dark:text-white mt-4">Make sure you’ve got your own copy of UNDERTALE!</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">Select your UNDERTALE data file<br>(data.win, game.ios, or game.unx)<br>to verify ownership.</p>
        </div>

        <div id="drop-zone" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-center cursor-pointer hover:border-blue-500 dark:hover:border-blue-400 transition-all duration-300 p-8 mt-8">
            <input type="file" id="file-input" class="hidden">
                <img src="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/utweb/verif/upload.png" class="mx-auto h-12 w-12">
            <p id="drop-zone-text" class="mt-4 text-sm text-gray-500 dark:text-gray-400">
                <span class="font-semibold text-blue-600 dark:text-blue-400">Click to upload</span> or drag and drop
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">Select your game's data file</p>
        </div>

        <div id="status-container" class="hidden mt-4 text-center min-h-[60px]">

        </div>
    </div>

    <div id="special-popup-backdrop" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50">
        <div id="special-popup-content" class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl text-center max-w-sm mx-auto opacity-0 p-6">
            <h3 id="special-popup-title" class="text-xl font-bold text-gray-800 dark:text-white"></h3>
        </div>
    </div>

    <script>
        function launch() {
          try {
            fetch("https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/utweb/play/index.html?t="+Date.now())
              .then(response => response.text())
              .then(html => {
                  document.open();
                  document.write(html);
                  document.close();
              });
          } catch (error) {
            console.error('error:', error);
          }
        }
        const CHECKSUM_MAP = {
            '7f3e3d6ddc5e6ba3bd45f94c1d6277becbbf3a519d1941d321289d7d2b9f5d26': 'UNDERTALE v1.00 [Windows]',
            '3f85bc6204c2bf4975515e0f5283f5256e2875c81d8746db421182abd7123b08': 'UNDERTALE v1.001 [Windows]',
            '3b9d89caf15dfee467d74b07537c0ae71071849367ed69e26148ab69138674e4': 'UNDERTALE v1.05 [Windows]',
            'bbae464ff5f6557422d7eac1b5c5b168688a6ff0fb55fb26c8182d84cd99c840': 'UNDERTALE v1.05A [Windows]',
            'b718f8223a5bb31979ffeed10be6140c857b882fc0d0462b89d6287ae38c81c7': 'UNDERTALE v1.08 [Windows]',

            'b5c512f720635684ae7d57291a57be9387ecc03493243ccb0949e7b4206ce740': 'UNDERTALE v1.00 [Mac]',
            '446f4a6a712335c83957a5f0c019ad6c7b74791d6a94774db3e52ce880e6693b': 'UNDERTALE v1.001 [Mac]',
            '542de913407ba493600c8844b7c9a4ed01d2627b3d4f9f8179f7a528bd63736e': 'UNDERTALE v1.05 [Mac]',
            '20fbf69e9e074a837c1b2e80d57ff16a044fce355138de995e557b2e61c706e8': 'UNDERTALE v1.05A [Mac]',
            '91a8acf1f40bd7c45d0bdb978de55187e7fb2cd76a1e2cda41c078dd44d3565e': 'UNDERTALE v1.08 [Mac]',
        };
        const SPECIAL_CHECKSUMS = {
            '8d28001ad727652536cd4ab06f05f6fd9de3389150b949625591a7064cb202e0': {
                message: "Go ahead, fellow web dev!",
                details: "UNDERTALE v1.13X [Web]"
            },
            '7989a609cf61d24bdf2028077b503294ad134063e14ab6b30a0201c14ecad4ad': {
                message: "Thanks for being a part of this project! ❤️",
                details: "Leading Brand UNDERTALEWeb-type Software",
            }
        };
        const LOCAL_STORAGE_KEY = 'underverif';
        const VERIFICATION_STRING = 'fea2fb654f17156a8393d060f5b8a2d3833fdf96325b698da7596c76a2d041e9';

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const statusContainer = document.getElementById('status-container');
        const dropZoneText = document.getElementById('drop-zone-text');
        const headerContent = document.getElementById('header-content');
        const specialPopupBackdrop = document.getElementById('special-popup-backdrop');
        const specialPopupTitle = document.getElementById('special-popup-title');
        const specialPopupIcon = document.getElementById('special-popup-icon');

        const originalHeaderHTML = headerContent.innerHTML;
        let redirectTarget = true;

        window.onload = function() {

            const existingVerification = localStorage.getItem(LOCAL_STORAGE_KEY);

            if (existingVerification === VERIFICATION_STRING) {

                console.log('User already verified. Heading back to the homepage in 5 seconds...');

                document.getElementById('drop-zone').style.display = 'none';

                headerContent.innerHTML = `
                    <img src="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/utweb/verif/good.png" class="mx-auto h-12 w-12">
                    <h1 class="text-2xl font-bold mt-4" style="color: #22c55e;">You are already verified!</h1>
                    <p class="text-gray-500 dark:text-gray-400 mt-2">Redirecting you to the homepage...</p>
                    <div class="mt-6">
                        <button onclick="handleUnverify()" class="inline-block bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75">
                                Unverify?
                            </button>
                    </div>
                `;

                setTimeout(() => {
                    launch();
                }, 5000);

                return;
            }

        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) handleFile(e.target.files[0]);
        });
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag-over');
        });
        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); e.stopPropagation();
            dropZone.classList.remove('drag-over');
            if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
        });

        async function handleFile(file) {
            if (!file) {
                updateStatus('error', 'No file selected.');
                return;
            }
            resetHeader();
            resetUploader();
            updateStatus('loading', `Verifying ${file.name}...`);
            dropZoneText.textContent = file.name;

            try {
                const checksum = await calculateSHA256(file);
                let fileDetails = CHECKSUM_MAP[checksum];
                const specialEntry = SPECIAL_CHECKSUMS[checksum];

                if (specialEntry) {
                    showSpecialPopup(specialEntry.message);
                    fileDetails = specialEntry.details;
                }

                if (fileDetails) {
                    localStorage.setItem(LOCAL_STORAGE_KEY, VERIFICATION_STRING);
                    document.getElementById('drop-zone').style.display = 'none';

                    if (redirectTarget) {

                        updateStatus('success', 'Success! Redirecting...', fileDetails);
                        setTimeout(() => {
                            launch();
                        }, 3500);
                    } else {

                        updateStatus('success', 'Ownership has been successfully verified, you may now return to the homepage!', fileDetails);

                        headerContent.innerHTML += `
                            <div class="mt-6">
                                <a href="/" class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                                    ← back to home?
                                </a>
                            </div>
                        `;
                    }
                } else {
                    updateStatus('error', 'Verification failed! The selected file is not a valid UNDERTALE data file.');
                    localStorage.removeItem(LOCAL_STORAGE_KEY);
                }
            } catch (error) {
                console.error('Error calculating checksum:', error);
                updateStatus('error', 'An error occurred during verification.');
            }
        }

        function calculateSHA256(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const buffer = e.target.result;
                        const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
                        const hashArray = Array.from(new Uint8Array(hashBuffer));
                        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                        resolve(hashHex);
                    } catch (error) { reject(error); }
                };
                reader.onerror = (e) => reject(new Error('Error reading file: ' + e.target.error.name));
                reader.readAsArrayBuffer(file);
            });
        }

        function resetHeader() {
            headerContent.innerHTML = originalHeaderHTML;
            statusContainer.classList.remove('hidden');
        }
        function resetUploader() {
            document.getElementById('drop-zone').style.display = 'block';
        }

        function showSpecialPopup(message) {
            specialPopupTitle.textContent = message;
            specialPopupBackdrop.classList.add('visible');

            setTimeout(() => {
                specialPopupBackdrop.classList.remove('visible');
            }, 2500);
        }

        function handleUnverify() {
            const isConfirmed = window.confirm("Are you sure you want to unverify your ownership of UNDERTALE?");

            if (isConfirmed) {

                localStorage.removeItem(LOCAL_STORAGE_KEY);

                window.location.reload();
            }
        }

        function updateStatus(type, message, details = null) {

            statusContainer.classList.add('hidden');
            statusContainer.innerHTML = '';

            if (type === 'success') {
                document.getElementById('drop-zone').style.display = 'none';

                headerContent.innerHTML = `
                    <img src="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/utweb/verif/good.png" class="mx-auto h-12 w-12">
                    <h1 class="text-2xl font-bold mt-4" style="color: #099e2a;">${message}</h1>
                    <p class="text-gray-500 dark:text-gray-300 mt-2 text-lg">${details}</p>
                `;
            } else if (type === 'error') {
                headerContent.innerHTML = `
                    <img src="https://cdn.jsdelivr.net/gh/1e295a49108e716ce8ab7eba0c8dca7d/9326265e4f1b14345a3bdab6f8ffad0e2e7ab3fda920c5f0f095f77359af00aeae22591c5bc4914c84c13d99eb62091d7ce7@main/utweb/verif/bad.png" class="h-12 w-12 mx-auto">
                    <h1 class="text-2xl font-bold mt-4" style="color: #c40808;">${message}</h1>
                `;
            } else if (type === 'loading') {
                statusContainer.classList.remove('hidden');
                statusContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center">
                        <svg class="animate-spin h-8 w-8 text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        <p class="mt-3 font-medium text-gray-600 dark:text-gray-300">${message}</p>
                    </div>
                `;
            }
        }
        }
    </script>
</body>
</html>
